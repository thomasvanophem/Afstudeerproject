<!DOCTYPE html>
<html>
	<head>
		<meta name="viewport" content="initial-scale=1.0, user-scalable=no">
		<meta charset="utf-8">
		<style>
			html, body {
				height: 100%;
				margin: 0px;
				padding: 0px
			}
			#menu {
				width: 100%;
				height: 50px;
				background-color: #4A4A4A;
			}
			#wrapper {
				height: 100%;
				width: 100%;
				background-color: #ffffff;
			}
			#map-canvas {
				height: 75%;
				width: 54%;
				margin-top: 50px;
				margin-right: 5%;
				margin-left: 5%;
				float: left;
				border: 1px solid #8E998E;
			}
			#results {
				height: 75%;
				width: 30%;
				margin-right: 5%;
				margin-top: 50px;
				background-color: #C2C2C2;
				float: right;
			}
			#menu ul {
				list-style-type: none;
				margin: 0;
				padding 0;
				overflow: hidden;
			}
			#menu ul li {
				float: left;
			}
			#menu a {
				display: block;
				color: #FFFFFF;
				text-decoration: none;
				padding-right: 20px;
				font-family: Arial;
				font-weight: bold;
				line-height: 50px;
			}
		</style>
		
		<script src="https://maps.googleapis.com/maps/api/js?v=3.exp&sensor=false&libraries=drawing"></script>
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
		<script>
			function loadXMLDoc(radius, x, y) {
				var xmlhttp;
				if (window.XMLHttpRequest) {
					// code for IE7+, Firefox, Chrome, Opera, Safari
					xmlhttp = new XMLHttpRequest();
				} else {
					// code for IE6, IE5
					xmlhttp = new ActiveXObject("Microsoft.XMLHTTP");
				}
				
				xmlhttp.onreadystatechange = function() {
					if (xmlhttp.readyState==4 && xmlhttp.status==200) {
						document.getElementById("results").innerHTML=xmlhttp.responseText;
					}
				}

				xmlhttp.open("POST","",true);
				xmlhttp.setRequestHeader("Content-type","application/x-www-form-urlencoded");
				xmlhttp.send("lat="+x+"&lon="+y+"&radius="+radius);
			}  
	  
			var selectedArea = null;
			
			function initialize() {
				var mapOptions = {
					center: new google.maps.LatLng(52.3740300, 4.8896900),
					zoom: 8
				};

				var map = new google.maps.Map(document.getElementById('map-canvas'), mapOptions);

				var drawingManager = new google.maps.drawing.DrawingManager({
											drawingMode: google.maps.drawing.OverlayType.CIRCLE,
											drawingControl: false,
											markerOptions: {
												icon: 'images/beachflag.png'
											},
												circleOptions: {
												fillColor: '#D3E6D3',
												fillOpacity: 0.5,
												strokeWeight: 1,
												clickable: false,
												editable: true,
												zIndex: 1
											}
										});
			  
				drawingManager.setMap(map);
				
				$('#map-canvas').on('mousedown', function() {
					if ( selectedArea ) {
						selectedArea.setMap(null);
						google.maps.event.clearInstanceListeners(selectedArea);
					}
	
					selectedArea = null;
				});

				google.maps.event.addListener(drawingManager, 'circlecomplete', function(circle) {
					selectedArea = circle;
				});
				
				google.maps.event.addListener(drawingManager, 'overlaycomplete', function(event) {
						if (event.type == google.maps.drawing.OverlayType.CIRCLE) {
							var center = event.overlay.getCenter();
							var radius = event.overlay.getRadius();
							//DEBUG
							console.log("Radius: "+radius/1000.0+" KM");
							console.log("Lat: "+center.k+" Lon: "+center.A);
							//Request to server
							loadXMLDoc(radius / 1000.0, center.k, center.A);
						}
					});
			}

			google.maps.event.addDomListener(window, 'load', initialize);
		</script>
		<title>
			$title
		</title>
	</head>
	<body>
		<div id="menu">
			<ul>
				<li>
					<a href="index3.html">Home</a>
				</li>
				<li>
					<a href="#">Contact</a>
				</li>
				<li>
					<a href="#">F.A.Q.</a>
				</li>
			</ul>
		</div>
		<div id="wrapper">
			<div id="map-canvas">
			</div>
			<div id="results">
				$content
			</div>
		</div>
	</body>
</html>
